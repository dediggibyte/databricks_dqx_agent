# App Resources
# Databricks App Definition for DQ Data Quality Manager
#
# Note: App runtime configuration (command, env vars) is defined in app.yaml
# which is deployed with the source code. This file only defines the DAB
# resource configuration.
#
# This app uses USER AUTHORIZATION - it acts on behalf of the logged-in user
# using their permissions. No explicit catalog/schema grants needed.
#
# Deploy: databricks bundle deploy -t <target>
# Run:    databricks bundle run dqx_app -t <target>

resources:
  apps:
    dqx_app:
      name: ${var.app_name}
      description: ${var.app_description}

      # Source code location - the src/ folder contains all app files
      source_code_path: ../src

      # User API scopes - app acts on behalf of logged-in user
      # Users will only see catalogs/schemas/tables they have access to
      user_api_scopes:
        # SQL scope for executing queries on SQL warehouses
        - "sql"

      # Resources the app can access
      resources:
        # Grant app permission to run the DQ generation job
        - name: "dqx-generation-job"
          description: "Job for generating DQ rules using AI"
          job:
            id: ${resources.jobs.dq_rule_generation.id}
            permission: "CAN_MANAGE_RUN"

        # Grant app permission to run the DQ validation job
        - name: "dqx-validation-job"
          description: "Job for validating DQ rules against data"
          job:
            id: ${resources.jobs.dq_rule_validation.id}
            permission: "CAN_MANAGE_RUN"
